<div class="app-container">
    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <h1 class="app-title">{{ title }}</h1>
            <p class="app-subtitle">
                <span class="phase-badge">Phase 2 - –ü–æ–¥-–∑–∞–¥–∞—á–∞ 1</span>
                File Upload and Data Management - Testing
            </p>
            <div class="mode-indicator">
                <span class="mode-badge" [class.production]="isProduction" [class.development]="!isProduction">
                    {{ getModeIcon() }} {{ getModeName() }} Mode
                </span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
        <div class="container">

            <!-- File Upload Section -->
            <section class="upload-section">
                <app-file-upload (fileImported)="onFileImported($event)"
                    (importConfirmed)="onImportConfirmed($event)"></app-file-upload>
            </section>

            <!-- Import Results Section -->
            @if (importData) {
            <section class="results-section card">
                <h2 class="text-success">üìã –†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –∏–º–ø–æ—Ä—Ç–∞</h2>

                <div class="results-grid">
                    <div class="result-card success">
                        <h3>‚úÖ –í–∞–ª–∏–¥–Ω–∏ –∑–∞–ø–∏—Å–∏</h3>
                        <div class="result-value">{{ importData.stats.validRecords }}</div>
                        <p>–ì–æ—Ç–æ–≤–∏ –∑–∞ SMS –∏–∑–ø—Ä–∞—â–∞–Ω–µ</p>
                    </div>

                    <div class="result-card info">
                        <h3>üìä –û–±—â–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <div class="result-details">
                            <div><strong>–§–∞–π–ª:</strong> {{ importData.fileInfo.name }}</div>
                            <div><strong>–†–∞–∑–º–µ—Ä:</strong> {{ formatFileSize(importData.fileInfo.size) }}</div>
                            <div><strong>–ò–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω:</strong> {{ formatDate(importData.importedAt) }}</div>
                        </div>
                    </div>

                    @if (importData.stats.invalidRecords > 0) {
                    <div class="result-card warning">
                        <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω–∏ –∑–∞–ø–∏—Å–∏</h3>
                        <div class="result-value">{{ importData.stats.invalidRecords }}</div>
                        <p>–ó–∞–ø–∏—Å–∏ —Å –≥—Ä–µ—à–∫–∏ –≤—ä–≤ –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞</p>
                    </div>
                    }
                </div>

                <!-- Sample Records Preview -->
                @if (importData.validRecords.length > 0) {
                <div class="sample-records">
                    <h3>üë• –ü—Ä–∏–º–µ—Ä–Ω–∏ –∑–∞–ø–∏—Å–∏ (–ø—ä—Ä–≤–∏—Ç–µ 3)</h3>
                    <div class="records-preview">
                        @for (record of importData.validRecords.slice(0, 3); track record.id) {
                        <div class="record-card">
                            <div class="record-header">
                                <strong>{{ record.Ime_Firma }}</strong>
                                <span class="record-id">{{ record.Number }}</span>
                            </div>
                            <div class="record-details">
                                <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ record.formattedPhone }}</div>
                                <div><strong>–û–±–µ–∫—Ç:</strong> {{ record.Ime_Obekt }}</div>
                                <div><strong>–î–æ–≥–æ–≤–æ—Ä –∏–∑—Ç–∏—á–∞:</strong> {{ record.End_Data }}</div>
                            </div>
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" (click)="startSMSPreview()"
                        [disabled]="!importData || importData.validRecords.length === 0" type="button">
                        üì® –ü—Ä–æ–¥—ä–ª–∂–∏ –∫—ä–º SMS Preview
                    </button>
                    <button class="btn btn-outline" (click)="resetImport()" type="button">
                        üîÑ –ù–æ–≤ –∏–º–ø–æ—Ä—Ç
                    </button>
                    <button class="btn btn-outline" (click)="showTestNotifications()" type="button">
                        üß™ –¢–µ—Å—Ç Notifications
                    </button>
                </div>
            </section>
            }

            <!-- Testing Instructions -->
            <section class="testing-instructions card">
                <h3 class="text-primary">üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ</h3>
                <div class="test-steps">
                    <div class="test-step">
                        <strong>1. –¢–µ—Å—Ç drag & drop:</strong> –ü—Ä–µ—Ö–≤—ä—Ä–ª–µ—Ç–µ JSON —Ñ–∞–π–ª –≤ upload –∑–æ–Ω–∞—Ç–∞
                    </div>
                    <div class="test-step">
                        <strong>2. –¢–µ—Å—Ç file picker:</strong> –©—Ä–∞–∫–Ω–µ—Ç–µ –≤ –∑–æ–Ω–∞—Ç–∞ –∑–∞ –∏–∑–±–æ—Ä –Ω–∞ —Ñ–∞–π–ª
                    </div>
                    <div class="test-step">
                        <strong>3. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è:</strong> –û–ø–∏—Ç–∞–π—Ç–µ —Å –Ω–µ–≤–∞–ª–∏–¥–µ–Ω —Ñ–∞–π–ª (–Ω–µ JSON)
                    </div>
                    <div class="test-step">
                        <strong>4. –¢–µ—Å—Ç –≥–æ–ª—è–º —Ñ–∞–π–ª:</strong> –û–ø–∏—Ç–∞–π—Ç–µ —Å —Ñ–∞–π–ª –Ω–∞–¥ {{ maxFileSizeFormatted }}
                    </div>
                    <div class="test-step">
                        <strong>5. –¢–µ—Å—Ç notifications:</strong> –©—Ä–∞–∫–Ω–µ—Ç–µ "–¢–µ—Å—Ç Notifications" –±—É—Ç–æ–Ω–∞
                    </div>
                    <div class="test-step">
                        <strong>6. –¢–µ—Å—Ç JSON structure:</strong> –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ JSON —Å ClientRecord —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
                    </div>
                </div>

                <!-- Sample JSON Structure -->
                <div class="json-sample">
                    <h4>üìÑ –ü—Ä–∏–º–µ—Ä–Ω–∞ JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:</h4>
                    <pre><code>{{ sampleJsonStructure }}</code></pre>
                </div>
            </section>

        </div>
    </main>

    <!-- Notifications -->
    <app-notification></app-notification>
</div>

<router-outlet></router-outlet>