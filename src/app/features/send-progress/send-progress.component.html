<!-- 
  Send Progress Component Template
  Shows real-time SMS sending progress with controls
-->

<div class="send-progress-container">

    <!-- Only show when there is progress data -->
    @if (progress) {
    <div class="send-progress" [class]="getStatusClass()">

        <!-- Progress Header with Status -->
        <div class="progress-header">
            <div class="status-info">
                <span class="status-icon">{{ getStatusIcon() }}</span>
                <span class="status-text">{{ getStatusText() }}</span>
            </div>
            <div class="status-badge" [class]="getStatusClass()">
                {{ getStatusText() }}
            </div>
        </div>

        <!-- Progress Bar Section -->
        <!-- Task 5.2.2: Enhanced Animated Progress Bar -->
        <div class="progress-bar-section">
            <div class="progress-bar-wrapper">

                <!-- Progress track with animated fill -->
                <div class="progress-bar-track">
                    <div class="progress-bar-fill" [class]="getStatusClass()" [style.width.%]="progress.percentage"
                        [attr.aria-valuenow]="progress.percentage" [attr.aria-valuemin]="0" [attr.aria-valuemax]="100"
                        role="progressbar">

                        <!-- Inner glow for active states -->
                        @if (progress.status === SendStatus.SENDING) {
                        <div class="progress-glow"></div>
                        }
                    </div>
                </div>

                <!-- Percentage display with enhanced styling -->
                <div class="progress-percentage" [class]="getStatusClass()">
                    <strong>{{ progress.percentage }}%</strong>

                    <!-- Status text inline with percentage for completed states -->
                    @if (progress.status === SendStatus.COMPLETED) {
                    <span class="completion-badge">‚úì –ó–∞–≤—ä—Ä—à–µ–Ω–æ</span>
                    }
                    @if (progress.status === SendStatus.CANCELLED) {
                    <span class="cancelled-badge">‚úó –û—Ç–º–µ–Ω–µ–Ω–æ</span>
                    }
                    @if (progress.status === SendStatus.FAILED) {
                    <span class="failed-badge">‚ö† –ì—Ä–µ—à–∫–∞</span>
                    }
                </div>

            </div>
        </div>

        <!-- Live Statistics Panel -->
        <!-- Task 5.2.3: Enhanced Statistics Display -->
        <div class="statistics-panel">

            <!-- Progress Counter (Main stat) -->
            <div class="stat-row stat-progress">
                <span class="stat-label">üìä –ü—Ä–æ–≥—Ä–µ—Å:</span>
                <span class="stat-value">
                    {{ progress.current }} / {{ progress.total }} SMS
                </span>
            </div>

            <!-- Success Count -->
            <div class="stat-row stat-success">
                <span class="stat-label">‚úÖ –£—Å–ø–µ—à–Ω–∏:</span>
                <span class="stat-value">{{ progress.successful }}</span>
            </div>

            <!-- Failed Count -->
            <div class="stat-row stat-failed">
                <span class="stat-label">‚ùå –ù–µ—É—Å–ø–µ—à–Ω–∏:</span>
                <span class="stat-value">{{ progress.failed }}</span>
            </div>

            <!-- Estimated Time Remaining -->
            @if (progress.estimatedTimeRemaining && progress.estimatedTimeRemaining > 0) {
            <div class="stat-row stat-time">
                <span class="stat-label">‚è±Ô∏è –û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ:</span>
                <span class="stat-value" [class.time-low]="progress.estimatedTimeRemaining < 10000">
                    {{ formatTime(progress.estimatedTimeRemaining) }}
                </span>
            </div>
            }

            <!-- Total Cost -->
            <div class="stat-row stat-cost">
                <span class="stat-label">üí∞ –û–±—â–∞ —Ü–µ–Ω–∞:</span>
                <span class="stat-value">{{ formatCost(progress.totalCost) }}</span>
            </div>

            <!-- Sending Speed (only when active) -->
            @if (progress.sendingSpeed && progress.sendingSpeed > 0) {
            <div class="stat-row stat-speed">
                <span class="stat-label">‚ö° –°–∫–æ—Ä–æ—Å—Ç:</span>
                <span class="stat-value">{{ progress.sendingSpeed }} SMS/sec</span>
            </div>
            }

            <!-- Current Status Message -->
            @if (progress.currentMessage) {
            <div class="stat-row current-message">
                <span class="stat-label">‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å:</span>
                <span class="stat-value">{{ progress.currentMessage }}</span>
            </div>
            }

            <!-- Operation Start Time (only when active) -->
            @if (progress.startTime && isActive) {
            <div class="stat-row">
                <span class="stat-label">üïê –ó–∞–ø–æ—á–Ω–∞—Ç–æ:</span>
                <span class="stat-value">{{ formatDateTime(progress.startTime) }}</span>
            </div>
            }

        </div>

        <!-- Control Buttons -->
        <!-- Task 5.2.4: Enhanced Controls with Keyboard Shortcuts -->
        <div class="control-buttons">

            <!-- Pause Button (when sending) -->
            @if (canPause) {
            <button class="btn btn-warning" (click)="onPause()" [disabled]="!canPause" title="Keyboard: Space">
                <span class="btn-icon">‚è∏Ô∏è</span>
                <span class="btn-text">–ü–∞—É–∑–∞</span>
            </button>
            }

            <!-- Resume Button (when paused) -->
            @if (canResume) {
            <button class="btn btn-primary" (click)="onResume()" [disabled]="!canResume" title="Keyboard: Space">
                <span class="btn-icon">‚ñ∂Ô∏è</span>
                <span class="btn-text">–ü—Ä–æ–¥—ä–ª–∂–∏</span>
            </button>
            }

            <!-- Cancel Button (when active) -->
            @if (canCancel) {
            <button class="btn btn-outline btn-danger" (click)="onCancel()" [disabled]="!canCancel"
                title="Keyboard: Escape">
                <span class="btn-icon">‚ùå</span>
                <span class="btn-text">–û—Ç–º–µ–Ω–∏</span>
            </button>
            }

            <!-- Close Button (when completed) -->
            @if (progress.status === SendStatus.COMPLETED ||
            progress.status === SendStatus.CANCELLED ||
            progress.status === SendStatus.FAILED) {
            <button class="btn btn-outline" (click)="onClose()" title="Close and reset">
                <span class="btn-icon">‚úñÔ∏è</span>
                <span class="btn-text">–ó–∞—Ç–≤–æ—Ä–∏</span>
            </button>
            }
        </div>

        <!-- Keyboard Shortcuts Hint (enhanced) -->
        @if (isActive) {
        <div class="keyboard-hints">
            <div class="hint-title">‚å®Ô∏è –ö–ª–∞–≤–∏—à–Ω–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:</div>
            <div class="hint-items">
                @if (canPause || canResume) {
                <span class="hint-item">
                    <kbd>Space</kbd>
                    {{ canPause ? '–ü–∞—É–∑–∞' : '–ü—Ä–æ–¥—ä–ª–∂–∏' }}
                </span>
                }
                @if (canCancel) {
                <span class="hint-item">
                    <kbd>Esc</kbd>
                    –û—Ç–º–µ–Ω–∏
                </span>
                }
            </div>
        </div>
        }

    </div>
    }

    <!-- Empty State (no progress data) -->
    @if (!progress || progress.status === SendStatus.IDLE) {
    <div class="empty-state">
        <p class="empty-message">–ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ</p>
    </div>
    }

</div>