<div class="client-list-container">

    <!-- Header with statistics -->
    <div class="list-header">
        <h2>üë• –ö–ª–∏–µ–Ω—Ç—Å–∫–∏ –∑–∞–ø–∏—Å–∏</h2>
        <div class="stats-bar">
            <div class="stat-badge">
                <span class="label">–û–±—â–æ:</span>
                <span class="value">{{ statistics.total }}</span>
            </div>
            <div class="stat-badge selected">
                <span class="label">–ò–∑–±—Ä–∞–Ω–∏:</span>
                <span class="value">{{ statistics.selected }}</span>
            </div>
            <div class="stat-badge filtered">
                <span class="label">–§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–∏:</span>
                <span class="value">{{ statistics.filtered }}</span>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section card">
        <h3>üîç –§–∏–ª—Ç—Ä–∏</h3>
        <div class="filters-grid">
            <div class="filter-field">
                <label>–¢—ä—Ä—Å–µ–Ω–µ</label>
                <input type="text" class="form-control" placeholder="–¢—ä—Ä—Å–∏ –≤—ä–≤ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞..."
                    [(ngModel)]="searchText" (ngModelChange)="onSearchChange()" />
            </div>
            <div class="filter-field">
                <label>–§–∏—Ä–º–∞</label>
                <input type="text" class="form-control" placeholder="–ò–º–µ –Ω–∞ —Ñ–∏—Ä–º–∞..." [(ngModel)]="companyFilter"
                    (ngModelChange)="onCompanyFilterChange()" />
            </div>
            <div class="filter-field">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" class="form-control" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä..." [(ngModel)]="phoneFilter"
                    (ngModelChange)="onPhoneFilterChange()" />
            </div>
            <div class="filter-field">
                <button class="btn btn-outline" (click)="clearFilters()" type="button">
                    ‚úï –ò–∑—á–∏—Å—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- Selection actions -->
    @if (selection.selectedCount > 0) {
    <div class="selection-actions card">
        <div class="selection-info">
            <strong>{{ selection.selectedCount }}</strong> –∏–∑–±—Ä–∞–Ω–∏ –∑–∞–ø–∏—Å–∞
        </div>
        <div class="action-buttons">
            <button class="btn btn-primary" (click)="onSendSMS()" type="button">
                üì® –ò–∑–ø—Ä–∞—Ç–∏ SMS
            </button>
            <button class="btn btn-outline" (click)="deselectAll()" type="button">
                ‚úï –ü—Ä–µ–º–∞—Ö–Ω–∏ –∏–∑–±–æ—Ä–∞
            </button>
        </div>
    </div>
    }

    <!-- CDK Table -->
    <div class="table-container card">
        @if (paginatedData.records.length === 0) {
        <div class="empty-state">
            @if (statistics.filtered === 0 && statistics.total > 0) {
            <div class="empty-icon">üîç</div>
            <div class="empty-text">–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç —Ñ–∏–ª—Ç—Ä–∏—Ç–µ</div>
            <button class="btn btn-outline" (click)="clearFilters()" type="button">
                –ò–∑—á–∏—Å—Ç–∏ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ
            </button>
            } @else {
            <div class="empty-icon">üìã</div>
            <div class="empty-text">–ù—è–º–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ –¥–∞–Ω–Ω–∏</div>
            }
        </div>
        } @else {
        <table cdk-table [dataSource]="dataSource" class="client-table">

            <!-- Checkbox Column -->
            <ng-container cdkColumnDef="select">
                <th cdk-header-cell *cdkHeaderCellDef class="checkbox-cell">
                    <input type="checkbox" [checked]="selection.allSelected" [indeterminate]="selection.indeterminate"
                        (change)="toggleSelectAll()" />
                </th>
                <td cdk-cell *cdkCellDef="let record" class="checkbox-cell">
                    <input type="checkbox" [checked]="record.selected" (change)="toggleSelection(record.id, $event)"
                        (click)="$event.stopPropagation()" />
                </td>
            </ng-container>

            <!-- Number Column -->
            <ng-container cdkColumnDef="Number">
                <th cdk-header-cell *cdkHeaderCellDef [class.sortable]="isSortable('Number')"
                    (click)="sortBy('Number')">
                    ‚Ññ –ó–∞–ø–∏—Å
                    @if (sorting.field === 'Number') {
                    <span class="sort-icon">{{ getSortIcon('Number') }}</span>
                    }
                </th>
                <td cdk-cell *cdkCellDef="let record">{{ record.Number }}</td>
            </ng-container>

            <!-- Company Column -->
            <ng-container cdkColumnDef="Ime_Firma">
                <th cdk-header-cell *cdkHeaderCellDef [class.sortable]="isSortable('Ime_Firma')"
                    (click)="sortBy('Ime_Firma')">
                    –§–∏—Ä–º–∞
                    @if (sorting.field === 'Ime_Firma') {
                    <span class="sort-icon">{{ getSortIcon('Ime_Firma') }}</span>
                    }
                </th>
                <td cdk-cell *cdkCellDef="let record" class="company-cell">
                    <strong>{{ record.Ime_Firma }}</strong>
                </td>
            </ng-container>

            <!-- Phone Column -->
            <ng-container cdkColumnDef="Phone">
                <th cdk-header-cell *cdkHeaderCellDef>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <td cdk-cell *cdkCellDef="let record">{{ record.formattedPhone }}</td>
            </ng-container>

            <!-- Model Column -->
            <ng-container cdkColumnDef="Model">
                <th cdk-header-cell *cdkHeaderCellDef>–ú–æ–¥–µ–ª</th>
                <td cdk-cell *cdkCellDef="let record">{{ record.Model }}</td>
            </ng-container>

            <!-- End Date Column -->
            <ng-container cdkColumnDef="End_Data">
                <th cdk-header-cell *cdkHeaderCellDef [class.sortable]="isSortable('End_Data')"
                    (click)="sortBy('parsedEndDate')">
                    –ò–∑—Ç–∏—á–∞ –Ω–∞
                    @if (sorting.field === 'parsedEndDate') {
                    <span class="sort-icon">{{ getSortIcon('End_Data') }}</span>
                    }
                </th>
                <td cdk-cell *cdkCellDef="let record">{{ formatDate(record.parsedEndDate) }}</td>
            </ng-container>

            <!-- Object Column -->
            <ng-container cdkColumnDef="Ime_Obekt">
                <th cdk-header-cell *cdkHeaderCellDef>–û–±–µ–∫—Ç</th>
                <td cdk-cell *cdkCellDef="let record">{{ record.Ime_Obekt || '-' }}</td>
            </ng-container>

            <!-- Header Row -->
            <tr cdk-header-row *cdkHeaderRowDef="displayedColumns"></tr>

            <!-- Data Rows -->
            <tr cdk-row *cdkRowDef="let row; columns: displayedColumns;" [class.selected]="row.selected"
                (click)="onRowClick(row)">
            </tr>
        </table>
        }
    </div>

    <!-- Pagination -->
    @if (paginatedData.totalPages > 1) {
    <div class="pagination-container">
        <div class="pagination-info">
            –ü–æ–∫–∞–∑–∞–Ω–∏ {{ paginatedData.page * paginatedData.pageSize + 1 }} -
            {{ Math.min((paginatedData.page + 1) * paginatedData.pageSize, paginatedData.totalRecords) }}
            –æ—Ç {{ paginatedData.totalRecords }}
        </div>

        <div class="pagination-controls">
            <button class="btn btn-outline btn-sm" [disabled]="!paginatedData.hasPreviousPage" (click)="firstPage()"
                type="button" title="–ü—ä—Ä–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                ‚èÆ
            </button>
            <button class="btn btn-outline btn-sm" [disabled]="!paginatedData.hasPreviousPage" (click)="previousPage()"
                type="button">
                ‚Üê –ü—Ä–µ–¥–∏—à–Ω–∞
            </button>
            <span class="page-indicator">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ paginatedData.page + 1 }} –æ—Ç {{ paginatedData.totalPages }}
            </span>
            <button class="btn btn-outline btn-sm" [disabled]="!paginatedData.hasNextPage" (click)="nextPage()"
                type="button">
                –°–ª–µ–¥–≤–∞—â–∞ ‚Üí
            </button>
            <button class="btn btn-outline btn-sm" [disabled]="!paginatedData.hasNextPage" (click)="lastPage()"
                type="button" title="–ü–æ—Å–ª–µ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                ‚è≠
            </button>
        </div>

        <div class="page-size-selector">
            <label>–ó–∞–ø–∏—Å–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞:</label>
            <select class="form-control" [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
                <option [value]="10">10</option>
                <option [value]="25">25</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
        </div>
    </div>
    }

</div>